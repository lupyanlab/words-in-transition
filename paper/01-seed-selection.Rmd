# Selecting seeds

```{r, include=FALSE}
library(dplyr)
library(ggplot2)
library(magrittr)
library(tidyr)

library(wordsintransition)

data("sound_similarity_6")
data("sound_similarity_4")
data("final_seeds")

drop_bad_trials <- . %>%
  filter(failed_catch_trial == 0, problem_with_audio == 0)

# Create a factor for ordered and missing filenames.
filename_map <- expand.grid(
    category = unique(sound_similarity_6$category),
    ix = 1:6
  ) %>%
  mutate(filename = paste0(category, "_0", ix, ".mp3")) %>%
  arrange(category, ix) %>%
  select(category, filename)

recode_filename <- function(frame, custom_levels) {
  if (!missing(custom_levels)) filename_levels <- custom_levels
  frame %>%
    mutate(filename_f = factor(filename, levels = filename_levels))
}

count_responses <- function(frame, filename_levels) {
  frame %>%
    drop_bad_trials() %>%
    recode_filename(custom_levels = filename_levels) %>%
    count(filename_f) %>%
    select(filename_f, n) %>%
    complete(filename_f, fill = list(n = 0)) %>%
    mutate(filename = as.character(filename_f)) %>%
    left_join(filename_map) %>%
    arrange(category, desc(n))
}

filename_levels <- filename_map$filename
sound_similarity_6_counts <- sound_similarity_6 %>%
  count_responses(filename_levels) %>%
  # label two most frequently selected messages as odd
  group_by(category) %>%
  mutate(odd_one_out = ifelse(n >= n[2], "odd", "normal")) %>%
  ungroup()

kept <- sound_similarity_6_counts %>%
  filter(odd_one_out == "normal") %>%
  .$filename %>%
  unique()

filename_levels <- filename_levels[filename_levels %in% kept]
final_categories <- c("water", "tear", "zipper", "glass")
sound_similarity_4_counts <- sound_similarity_4 %>%
  count_responses(filename_levels) %>%
  # label categories used in final experiment
  mutate(odd_one_out = ifelse(category %in% final_categories, "normal", "odd"))
```

Our goal in selecting sounds to serve as seeds in the transmission chains was to
pick multiple sounds within a few different categories such that each category
member was approximately equally distinguishable from the other sounds within
the same category. To do this, we started with an initial set of 6 categories
and 6 sounds in each category and conducted 2 rounds of norming to reduce the
initial set to a final set of 16 seed sounds: 4 sounds in each of 4 categories.

## Methods

### Participants

```{r participants, results="asis", echo=FALSE}
summarize_participants <- function(frame, round_n) {
  dropped <- frame %>%
    filter(failed_catch_trial == 1) %>%
    .$workerId %>%
    unique() %>%
    length()

  data_frame(
    Round = round_n,
    N = length(unique(frame$workerId)),
    Dropped = dropped
  )
}


rbind(
  summarize_participants(sound_similarity_6, 1),
  summarize_participants(sound_similarity_4, 2)
) %>%
  pander::pandoc.table()
```

### Procedure

Participants listened to the sounds in each category and picked the one that
they thought was **the most different** from the others. In the first round of
norming, participants listened to 6 sounds on a given trial. We removed the
sounds in each category that were the most different from the others, and
repeated the norming process again with 5 sounds in each category. The resulting
sounds that were selected in each category are considered to be a set of equally
distinguishable category members.

## Results

```{r odd-one-out, include=FALSE}
odd_one_out <- ggplot(mapping = aes(x = filename_f, y = n)) +
  geom_bar(aes(fill = odd_one_out), stat = "identity") +
  scale_x_discrete("") +
  scale_fill_manual("", labels = c("kept", "dropped"),
                    values = RColorBrewer::brewer.pal(3, "Set2")[c(1, 2)]) +
  facet_wrap("category", scales = "free_x", ncol = 2) +
  theme_minimal() +
  theme(
    axis.ticks = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.direction = "vertical",
    legend.position = c(0.06, 1.0)
  )
```

### Round 1

```{r odd-one-out-1, echo=FALSE, fig.height=10}
(odd_one_out %+% sound_similarity_6_counts) +
  ggtitle("Odd one out (6 per category)")
```

### Round 2

```{r odd-one-out-2, echo=FALSE, fig.height=10}
(odd_one_out %+% sound_similarity_4_counts) +
  ggtitle("Odd one out (4 per category)")
```

### Final seeds

```{r final-seeds, echo=FALSE, results="asis"}
# The audio only works with html obviously but whatever goes between
# the audio tags will be rendered in pdf/word outputs.
player <- '<audio src="%s" controls>%s</audio>'
caption <- "Environmental sounds used as \"seed messages\" in the experiment."

final_seeds %>%
  mutate(
    url = paste0('http://sapir.psych.wisc.edu/telephone/seeds/', filename),
    # A markdown link is required in order to render properly in pdf/word.
    link = sprintf('[%s](%s)', filename, url),
    play = sprintf(player, url, link)
  ) %>%
  select(Category = category, Exemplar = play) %>%
  arrange(Category) %>%
  pander::pandoc.table(justify = "left", split.tables = Inf, caption = caption)
```